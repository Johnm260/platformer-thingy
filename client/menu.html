<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Platformer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #87CEEB; /* Sky blue for visual clarity */
        }

        .menu-container {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 300px;
        }

        input, button {
            margin-bottom: 20px;
            padding: 10px;
            font-size: 18px;
            width: 200px;
        }
        
        .redSlider {
          -webkit-appearance: none;
          width: 90%;
          height: 5px;
          background: #FF0000;
          outline: none;
          opacity: 0.7;
          -webkit-transition: .2s;
          transition: opacity .2s;
        }

        .redSlider:hover {
          opacity: 1;
        }

        .redSlider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 30px;
          height: 30px;
          background: #CCCCCC;
          cursor: pointer;
        }

        .redSlider::-moz-range-thumb {
          width: 30px;
          height: 30px;
          background: #CCCCCC;
          cursor: pointer;
        }
        .greenSlider {
          -webkit-appearance: none;
          width: 90%;
          height: 5px;
          background: #00FF00;
          outline: none;
          opacity: 0.7;
          -webkit-transition: .2s;
          transition: opacity .2s;
        }

        .greenSlider:hover {
          opacity: 1;
        }

        .greenSlider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 30px;
          height: 30px;
          background: #CCCCCC;
          cursor: pointer;
        }

        .greenSlider::-moz-range-thumb {
          width: 30px;
          height: 30px;
          background: #CCCCCC;
          cursor: pointer;
        }
        .blueSlider {
          -webkit-appearance: none;
          width: 90%;
          height: 5px;
          background: #0000FF;
          outline: none;
          opacity: 0.7;
          -webkit-transition: .2s;
          transition: opacity .2s;
        }

        .blueSlider:hover {
          opacity: 1;
        }

        .blueSlider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 30px;
          height: 30px;
          background: #CCCCCC;
          cursor: pointer;
        }

        .blueSlider::-moz-range-thumb {
          width: 30px;
          height: 30px;
          background: #CCCCCC;
          cursor: pointer;
        }
        .color-slider {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .color-slider input[type="range"] {
            width: 200px;
            height: 10px;
            border-radius: 5px;
            margin-right: 10px;
        }

        
        

        .number-input {
            width: 60px;
            text-align: center;
            font-size: 16px;
        }

        .color-preview {
            width: 100px;
            height: 100px;
            padding: 10px;
            border-radius: 0px;
            margin-bottom: 10px;
            margin-left: 0px;
            display: inline-block;
            border: 0px solid black; /* Black border for the preview box */
        }
        .sprite-preview-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            gap: 30px;
        }

        .sprite-nav-btn {
            font-size: 48px;
            padding: 5px 5px;
            cursor: pointer;
            border-radius: 6px;
            border: 0px solid #aaa;
            background-color: #f0f0f000;
            transition: background-color 0.2s;
        }

        .sprite-nav-btn:hover {
            background-color: #ddd;
        }
        .dropdown {
          width: 200px;
          height: 40px;
          font-size: 16px
        }


    </style>
</head>
<body>
    <div class="menu-container">
      <h1>Weapon 1 (Q)</h1>
      <select name="weapon1" id="weapon1" class="dropdown">
        <option value="arrow">Arrow</option>
        <option value="bomb">Bomb</option>
        <option value="shotgun">Shotgun</option>
        <option value="knife">Knife</option>
        <option value="ball">Ball</option>
      </select>
      <h1>Controls:</h1>
      <h1>WASD to move</h1>
      <h1>Shift to Dash</h1>
      <h1>Q to shoot Weapon #1</h1>
      <h1>E to shoot Weapon #2</h1>
    </div>
      
      
    <div class="menu-container">
        <h1>Enter your name:</h1>
        <input type="text" id="playerName" placeholder="Your name" maxlength="20" />
        
        <div class="color-slider">
            <input type="range" id="redSlider" min="0" max="255" value="255" class="redSlider">
            <input type="number" id="redNumber" class="number-input" min="0" max="255" value="255">
        </div>

        <div class="color-slider">
            <input type="range" id="greenSlider" min="0" max="255" value="255" class="greenSlider">
            <input type="number" id="greenNumber" class="number-input" min="0" max="255" value="255">
        </div>

        <div class="color-slider">
            <input type="range" id="blueSlider" min="0" max="255" value="255" class="blueSlider">
            <input type="number" id="blueNumber" class="number-input" min="0" max="255" value="255">
        </div>

        <div>
            <button id="startButton">Play</button>
        </div>

        <div class="sprite-preview-wrapper">
            <button id="prevSprite" class="sprite-nav-btn">⬅️</button>
            
            <canvas id="colorPreview" class="color-preview" width="64" height="64"></canvas>
            
            <button id="nextSprite" class="sprite-nav-btn">➡️</button>
        </div>

    </div>
    
    <div class="menu-container">
      <h1>Weapon 2 (E)</h1>
      <select name="weapon2" id="weapon2" class="dropdown">
        <option value="arrow">Arrow</option>
        <option value="bomb">Bomb</option>
        <option value="shotgun">Shotgun</option>
        <option value="knife">Knife</option>
        <option value="ball">Ball</option> 
      </select>
    </div>

    <script>
    const redSlider = document.getElementById("redSlider");
    const greenSlider = document.getElementById("greenSlider");
    const blueSlider = document.getElementById("blueSlider");
    const redNumber = document.getElementById("redNumber");
    const greenNumber = document.getElementById("greenNumber");
    const blueNumber = document.getElementById("blueNumber");
    const canvas = document.getElementById("colorPreview");
    const ctx = canvas.getContext("2d");
    const weapon1Select = document.getElementById("weapon1");
    const weapon2Select = document.getElementById("weapon2");
    const secretWeaponValue = "skateboard";
    const secretWeaponText = "Skateboard";
    
    
    checkSecretWeaponCondition();
    document.getElementById("weapon1").value = localStorage.getItem("weapon1");
    document.getElementById("weapon2").value = localStorage.getItem("weapon2");

    const spriteList = [
        "assets/sprite1.png",
        "assets/sprite2.png",
        "assets/sprite3.png",
        "assets/sprite4.png",
        "assets/sprite5.png"
    ];
    let currentSpriteIndex = localStorage.getItem("spriteIndex");
    const sprite = new Image();

    // Load saved player color from localStorage if available
    const savedColor = JSON.parse(localStorage.getItem("playerColor"));
    if (savedColor) {
        redSlider.value = savedColor.red;
        greenSlider.value = savedColor.green;
        blueSlider.value = savedColor.blue;

        redNumber.value = savedColor.red;
        greenNumber.value = savedColor.green;
        blueNumber.value = savedColor.blue;
    }

    // Load saved player name
    const savedName = localStorage.getItem("playerName");
    if (savedName) {
        document.getElementById("playerName").value = savedName;
    }

    function drawTintedSprite(r, g, b) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(sprite, 0, 0, canvas.width, canvas.height);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        for (let i = 0; i < data.length; i += 4) {
            const redPx = data[i];
            const greenPx = data[i + 1];
            const bluePx = data[i + 2];
            const alpha = data[i + 3];

            const brightness = 0.299 * redPx + 0.587 * greenPx + 0.114 * bluePx;

            if (alpha > 0 && brightness > 30) {
                const intensity = brightness / 255;
                data[i] = r * intensity;
                data[i + 1] = g * intensity;
                data[i + 2] = b * intensity;
            }
        }

        ctx.putImageData(imageData, 0, 0);
    }

    function updateColorPreview() {
        const r = parseInt(redSlider.value);
        const g = parseInt(greenSlider.value);
        const b = parseInt(blueSlider.value);

        redNumber.value = r;
        greenNumber.value = g;
        blueNumber.value = b;

        drawTintedSprite(r, g, b);
    }

    function loadSprite(index) {
        sprite.src = spriteList[index];
        sprite.onload = () => {
            updateColorPreview(); // Apply current color to the new sprite
        };
    }
    
    

    // Function to add the secret weapon if the conditions are met
    function checkSecretWeaponCondition() {
      
        const w1 = weapon1Select.value;
        const w2 = weapon2Select.value;

        if (w1 === "skateboard"){
          weapon2Select.value = 'none';
        }

        // Check if conditions are met
        if ((w1 === "arrow" && w2 === "knife") ||  w1 === "skateboard" || localStorage.weapon1 === "skateboard") {
            let alreadyExists = Array.from(weapon1Select.options).some(
                opt => opt.value === secretWeaponValue
            );
            if (localStorage.weapon1 === "skateboard"){
                weapon1Select.value = 'skateboard';
            }
            if (!alreadyExists) {
                let option = document.createElement("option");
                option.value = secretWeaponValue;
                option.text = secretWeaponText;
                weapon1Select.appendChild(option);
            }
        } else {
            // Remove it if it's there but conditions aren't met
            Array.from(weapon1Select.options).forEach((opt, idx) => {
                if (opt.value === secretWeaponValue) {
                    weapon1Select.remove(idx);
                }
            });
        }
    }

    // Add event listeners to both weapon selectors
    weapon1Select.addEventListener("change", checkSecretWeaponCondition);
    weapon2Select.addEventListener("change", checkSecretWeaponCondition);

    // Call on initial load too, in case they were pre-filled
    checkSecretWeaponCondition();


    // Sprite switching buttons
    document.getElementById("prevSprite").addEventListener("click", () => {
        currentSpriteIndex = (currentSpriteIndex - 1 + spriteList.length) % spriteList.length;
        loadSprite(currentSpriteIndex);
        localStorage.setItem("selectedSprite", "sprite" + currentSpriteIndex);
        localStorage.setItem("spriteIndex", currentSpriteIndex);
    });

    document.getElementById("nextSprite").addEventListener("click", () => {
        currentSpriteIndex = (currentSpriteIndex + 1) % spriteList.length;
        loadSprite(currentSpriteIndex);
        localStorage.setItem("selectedSprite", "sprite" + currentSpriteIndex);
        localStorage.setItem("spriteIndex", currentSpriteIndex);
    });

    // Event listeners for sliders
    redSlider.addEventListener("input", updateColorPreview);
    greenSlider.addEventListener("input", updateColorPreview);
    blueSlider.addEventListener("input", updateColorPreview);

    // Event listeners for number inputs
    redNumber.addEventListener("input", () => {
        redSlider.value = redNumber.value;
        updateColorPreview();
    });
    greenNumber.addEventListener("input", () => {
        greenSlider.value = greenNumber.value;
        updateColorPreview();
    });
    blueNumber.addEventListener("input", () => {
        blueSlider.value = blueNumber.value;
        updateColorPreview();
    });

    // Play button logic
    document.getElementById("startButton").addEventListener("click", () => {
        var selectedWeapon1 = document.getElementById("weapon1").value;
        var selectedWeapon2 = document.getElementById("weapon2").value;
          
      const playerName = document.getElementById("playerName").value;
      if (playerName) {
          const red = redSlider.value;
          const green = greenSlider.value;
          const blue = blueSlider.value;

          if (!(currentSpriteIndex > -1)){
              currentSpriteIndex = 0;
          }
          localStorage.setItem("selectedSprite", "sprite" + currentSpriteIndex);
          localStorage.setItem("spriteIndex", currentSpriteIndex);
          localStorage.setItem("playerName", playerName);
          localStorage.setItem("playerColor", JSON.stringify({ red, green, blue }));
          localStorage.setItem("weapon1", selectedWeapon1);
          localStorage.setItem("weapon2", selectedWeapon2);

          window.location.href = "index.html";
      } else {
          alert("Please enter a name.");
      }
    });

    // Initial load
    loadSprite(currentSpriteIndex);
</script>

</body>
</html>
